{% extends 'base.html' %}

{% block content %}
<div class="container mt-4">
    {% if user.groups.all.0.name == "Директор департамента" or user.is_superuser %}
    <a href="{% url 'workload_department_create' %}" class="btn btn-primary mb-3">Добавить дисциплину</a>
    {% endif %}
    
    <h2>Нагрузка на департамент</h2>

    <h4>Отчет по дисциплинам</h4>
    <table class="table table-bordered">
        <thead class="table-dark">
            <tr>
                <th>Дисциплина</th>
                <th>Выделено часов</th>
                <th>Распределено часов</th>
                <th>Осталось распределить</th>
            </tr>
        </thead>
        <tbody>
            {% for item in report %}
            <tr class="{% if item.remaining_hours == 0 %}table-success{% else %}table-warning{% endif %}">
                <td>{{ item.discipline }}</td>
                <td>{{ item.total_hours_department }}</td>
                <td>{{ item.total_hours_teachers }}</td>
                <td>{{ item.remaining_hours }}</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="4">Нет данных</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <hr>

    <h4>Подробная нагрузка по дисциплинам и подгруппам</h4>
    <ul class="list-group">
        {% for wd in workload_departments %}
            <li class="list-group-item">
                <a href="{% url 'workload_department_detail' wd.pk %}">
                    {{ wd.workload.disciplines }} — 
                    {{ wd.workload.load_types }} — 
                    {{ wd.workload.groups }} — 
                    Семестр {{ wd.workload.semesters }} — 
                    Подгруппа {{ wd.subgroups }} — 
                    {{ wd.hours }} ч.
                </a>
            </li>
        {% empty %}
            <li class="list-group-item">Нагрузка не найдена</li>
        {% endfor %}
    </ul>
</div>
{% endblock %}
